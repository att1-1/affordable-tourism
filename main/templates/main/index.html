{% load static %}
{% load main_tags %}

<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8"> 
    <!-- Подключение bootstrap -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Подключение bootstrap -->
    <link href="{% static "deps/css/style.css" %}" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Schibsted+Grotesk:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="{% static "deps/favicon/favicon.png" %}">
    <link rel="icon" type="image/x-icon" href="{% static "deps/favicon/favicon.ico" %}">
    <title>Доступный туризм</title>
  </head>
  <body class="page">
    <header class="page-header">
      <nav class="main-nav">
        <p class="logo">
          <img src="{% static "deps/images/Group 32.png" %}" width="415" height="75" alt="Логотип">
        </p>
        <ul class="site-navigation">
          <li class="site-navigation-item">
            <a href="#">Начало</a>
          </li>
          <li class="site-navigation-item">
            <a href="#">Список снаряжения</a>
          </li>
          <li class="site-navigation-item">
            <a href="#">Техника безопасности</a>
          </li>
          <li class="site-navigation-item">
            <a href="#">Маршруты</a>
          </li>
        </ul>
      </nav>
    </header>
    <main class="main-content">
        
        <article class="blog-articlee blog-article-1">
          <div class="blog-article-inner pt-sans-regular">
            <div class="blog-article-content">
              <p class="blog-article-description">Испытание «Туристский поход с проверкой туристских навыков»</p>
              <h2 class ="custom-title">СВЕРДЛОВСКАЯ ОБЛАСТЬ</h2>
              <p class="blog-article-description-1">Выполнение нормативов испытания (теста) туристский поход проводится в виде прохождения маршрута протяженностью не менее указанного количества километров, установленных государственными требованиями Всероссийского физкультурно-спортивного комплекса «Готов к труду и обороне» с III по IX ступени, и проверки туристских навыков.</p>
            </div>
            <img class="blog-article-img" src="{% static "deps/images/nature.jpg" %}" width="809" height="476" alt="Природа">
          </div>
        </article>

      
      <article class="blog-article-2">
        <div class="blog-article-content-2">
          <h2 class="pt-sans-bold">В РАМКАХ АКЦИИ ВСЕРОССИЙСКИЙ ДЕНЬ ПВД</h2>
          <p class="blog-article-description-2 pt-sans-regular">Совершение похода выходного дня (ПВД) по эталонному маршруту длиной 5-15 км (в  зависимости от возраста участников), со сдачей турнавыков в рамках ПВД в составе сборной плановой группы сформированной для прохождения  испытания в сопровождении инструкторов спортивного туризма (судей по  виду спорта спортивный туризм). </p>
        </div>

    
      <section class="Equipment">
        <h2 class="text-with-line pt-sans-bold blur">ИЗУЧИТЕ СПИСОК СНАРЯЖЕНИЯ КОТОРОЕ НЕОБХОДИМО БУДЕТ ВЗЯТЬ С <br>СОБОЙ НА МАРШРУТ</h2>
        <ul class="cards">
          <li class="custom-card">
            <div class="card-content">
              <h3 class="card-title inter-uniquifier-600">ЛИЧНОЕ СНАРЯЖЕНИЕ </h3>
              <ul class="card-description">
                  <li>Продукты для 2 перекуса на маршруте</li>
                  <li>Термос</li>
                  <li>Бутылка воды</li>
                  <li>Туалетные принадлежности</li>
                  <li>Рюкзак с поясом объемом до 40 литров</li>
                  <li>Пенка-сидушка</li>
                  <li>Кружка, миска, ложка, нож (в мешочке)</li>
                  <li>Фонарик</li>
              </ul>
            </div>
          </li>
          <li class="custom-card">
            <div class="card-content">
              <h3 class="card-title inter-uniquifier-600">ОДЕЖДА И ОБУВЬ</h3>
              <ul class="card-description">
                  <li>Обувь (основная) — ботинки кожаные, закрывающие голеностоп, со шуровкой на рифленой подошве, с толстой стелькой</li>
                  <li>Обувь (запасная) – кроссовки (сапоги) (с толстой стелькой) </li>
                  <li>Штормовой костюм однослойный (куртка, брюки). Водоотталкивающая, ветроустойчивая, огнеупорная ткань</li>
                  <li>Накидка от дождя</li>
                  <li>Свитер (кофта) легкая, теплосберегающая</li>
                  <li>Термобелье (в случае если t воздуха ниже 5 градусов)</li>
                  <li>1 запасной комплект нательного белья (футболка, трусы, носки)</li>
              </ul>
            </div>
          </li>
          <li class="custom-card">
            <div class="card-content">
              <h3 class="card-title inter-uniquifier-600">ДОПОЛНИТЕЛЬНОЕ ОБОРУДОВАНИЕ</h3>
              <ul class="card-description">
                  <li>Обязательно медицинская справка паспортa и полис ОМС </li>
                  <li>Спички или зажигалка в гермоупаковке</li>
                  <li>Компас</li>
                  <li>Индивидуальная аптечка</li>
              </ul>
            </div>
          </li>
          <li class="custom-card">
            <div class="card-content">
              <h3 class="card-title inter-uniquifier-600">ГРУППОВОЕ СНАРЯЖЕНИЕ</h3>
              <ul class="card-description">
                  <li>Пила</li>
                  <li>Топор</li>
                  <li>Котелок (не менее 3 литров)</li>
                  <li>Пакет для мусора до 80 литров</li>
              </ul>
            </div>
          </li>
        </ul>
      </section>

      <section class="Equipment">
        <h2 class="text-with-line pt-sans-bold blur">ОЗНАКОМЬТЕСЬ С ТЕХНИКОЙ БЕЗОПАСНОСТИ ПРИ ПРОВЕДЕНИИ ПОХОДОВ <br>ВЫХОДНОГО ДНЯ (ПВД) В РАМКАХ СДАЧИ НОРМ ГТО</h2>
        <ul class="cards-2">
          <li class="card-2">
            <div class="card-content">
              <h3 class="card-title inter-uniquifier-600">УЧАСТНИКИ ОБЯЗАНЫ </h3>
              <ul class="card-description-2">
                <li>Иметь необходимо количество личного снаряжения, согласно списка</li>
                <li>Выполнять все рекомендации инструктора</li>
                <li>Соблюдать правила поведения и установленные режимы передвижения как в городской, так и антропогенной средах</li>
                <li>Соблюдать правила техники безопасности и личной гигиены на протяжении всего мероприятия</li>
                <li>При возникновении потенциальной опасной ситуации незамедлительно принять меры по устранению опасности или выйти за пределы опасной зоны</li>
                <li>При получении травмы сообщить об этом инструктору и принять меры по оказанию неотложной помощи</li>
                <li>Пакет для мусора до 80 литров</li>            
              </ul>
            </div>
          </li>
          <li class="card-2">
            <div class="card-content">
              <h3 class="card-title inter-uniquifier-600">В РАМКАХ ПВДЗАПРЕЩАЕТСЯ</h3>
              <ul class="card-description-2">
                <li>Разведение костров в необорудованных костровой ямой местах, вне мест указанных инструктором</li>
                <li>Пробовать на вкус ягоды и орехи, а так же прочие части растений</li>
                <li>Прикасаться к представителям фауны леса и города</li>
                <li>Пить воду из неизвестных источников</li>         
              </ul>
            </div>
          </li>
          <li class="card-2">
            <div class="card-content">
              <h3 class="card-title inter-uniquifier-600">В РАМКАХ ПВД РЕКОМЕНДУЕТСЯ</h3>
              <ul class="card-description-2">
                <li>Уважать местные традиции и обычаи</li>
                <li>Бережно относится к памятникам природы, истории и культуры</li>
                <li>Беречь личное и групповое снаряжение</li>
                <li>Оказывать поддержку товарищам при прохождении маршрута</li>           
              </ul>
            </div>
          </li>
        </ul>
      </section>
          
      <div class="filter">
        <h2 class="text-with-line pt-sans-bold blur">ВЫБЕРИТЕ ПОДХОДЯЩИЙ МАРШРУТ И СРОКИ</h2>
        <div class="filters">
          <!-- Сортировка по уровням (возрастным группам) -->
          <div class="dropdown">
            <button onclick="toggleDropdown('levelDropdown')" class="dropbtn pt-sans-bold">Уровни</button>
            <div id="levelDropdown" class="dropdown-content">
              <form action="" method="get">
                <p class="form-title">Сортировать:</p>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="level" id="levelDefault" value=""
                  {% if 'level' not in request.GET %}checked{% endif %}>
                  <label class="form-check-label" for="levelDefault">По умолчанию</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="level" id="levelAsc" value="level" 
                  {% if request.GET.level == 'level' %}checked{% endif %}>
                  <label class="form-check-label" for="levelAsc">От простых к сложным</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="level" id="levelDesc" value="-level" 
                  {% if request.GET.level == '-level' %}checked{% endif %}>
                  <label class="form-check-label" for="levelDesc">От сложных к простым</label>
                </div>
                <button type="submit" class="btn-submit">Применить</button>
              </form>
            </div>
          </div>
        
          <!-- Сортировка по протяженности -->
          <div class="dropdown">
            <button onclick="toggleDropdown('distanceDropdown')" class="dropbtn pt-sans-bold">Протяженность</button>
            <div id="distanceDropdown" class="dropdown-content">
              <form action="" method="get">
                <p class="form-title">Сортировать:</p>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="distance" id="distanceDefault" value=""
                  {% if 'distance' not in request.GET %}checked{% endif %}>
                  <label class="form-check-label" for="distanceDefault">По умолчанию</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="distance" id="distanceAsc" value="distance"
                  {% if request.GET.distance == 'distance' %}checked{% endif %}>
                  <label class="form-check-label" for="distanceAsc">От коротких к длинным</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="distance" id="distanceDesc" value="-distance"
                  {% if request.GET.distance == '-distance' %}checked{% endif %}>
                  <label class="form-check-label" for="distanceDesc">От длинных к коротким</label>
                </div>
                <button type="submit" class="btn-submit">Применить</button>
              </form>
            </div>
          </div>
        
          <!-- Сортировка по продолжительности -->
          <div class="dropdown">
            <button onclick="toggleDropdown('durationDropdown')" class="dropbtn pt-sans-bold">Продолжительность</button>
            <div id="durationDropdown" class="dropdown-content">
              <form action="" method="get">
                <p class="form-title">Сортировать:</p>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="duration" id="durationDefault" value=""
                  {% if 'duration' not in request.GET %}checked{% endif %}>
                  <label class="form-check-label" for="durationDefault">По умолчанию</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="duration" id="durationAsc" value="duration"
                  {% if request.GET.duration == 'duration' %}checked{% endif %}>
                  <label class="form-check-label" for="durationAsc">От коротких к длинным</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="duration" id="durationDesc" value="-duration"
                  {% if request.GET.duration == '-duration' %}checked{% endif %}>
                  <label class="form-check-label" for="durationDesc">От длинных к коротким</label>
                </div>
                <button type="submit" class="btn-submit">Применить</button>
              </form>
            </div>
          </div>

          <!-- ФИЛЬТРАЦИЯ по сезону -->
          <div class="dropdown">
            <button onclick="toggleDropdown('seasonDropdown')" class="dropbtn pt-sans-bold">Сезон</button>
            <div id="seasonDropdown" class="dropdown-content">
              <form action="" method="get">
                <p class="form-title">Выберите сезоны:</p>
                {% for season in all_seasons %}
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="season" 
                         id="season{{ season.id }}" value="{{ season.id }}"
                         {% if season.id|stringformat:"s" in request.GET.getlist|stringformat:"s" %}checked{% endif %}>
                  <label class="form-check-label" for="season{{ season.id }}">
                    {{ season.name }}
                  </label>
                </div>
                {% endfor %}
                <button type="submit" class="btn-submit">Применить</button>
              </form>
            </div>
          </div>
        </div>
      </div>
          {% for route in routes %}
            <div class="containerr">
              <div class="left">
                  <div class="grid">
                      <div class="row">
                          <img src="{% static "deps/images/book.png" %}" alt="Иконка">
                          <strong>Код маршрута:</strong> {{ route.id }}
                      </div>
                      <div class="row">
                        <img src="{% static "deps/images/blank.png" %}" alt="Иконка">
                        <strong>Возрастные ступени:</strong>
                        {% for age_group in route.age_groups.all %}
                            {{ age_group.code }}{% if not forloop.last %}, {% endif %}
                        {% empty %}
                            Не указано
                        {% endfor %}
                    </div>
                      <div class="row">
                        <img src="{% static "deps/images/clock.png" %}" alt="Иконка">
                        <div>
                          <strong>Продолжительность:</strong> 
                          {{ route.duration|floatformat }} {{ route.duration|hours_format }}
                        </div>
                      </div>
                      <div class="row">
                          <img src="{% static "deps/images/Map01.png" %}" alt="Иконка">
                          <strong>Протяженность:</strong> {{ route.distance }} км
                      </div>
                      <div class="row">
                        <img src="{% static "deps/images/Car.png" %}" alt="Иконка">
                        <div>
                          <strong>Способ передвижения:</strong> {{ route.transportation_method }}
                        </div>
                      </div>
                      <div class="row">
                          <img src="{% static "deps/images/coin.png" %}" alt="Иконка">
                          <strong>Стоимость:</strong>{% if route.cost == 0 %}
                            Бесплатно
                          {% else %}
                            {{ route.cost }}
                          {% endif %}
                      </div>
                  </div>
      
                  <div class="row">
                      <img src="{% static "deps/images/Calendar.png" %}" alt="Иконка">
                      <strong>Дата проведения:</strong> {{ route.event_dates|default:"Дата не указана" }}
                  </div>
                  <div class="row">
                      <img src="{% static "deps/images/home.png" %}" alt="Иконка">
                      <div>
                        <strong>Проводящая организация:</strong> {{ route.organizer_name|default:"Не указана" }}
                      </div>
                  </div>
                  <div class="row">
                    <img src="{% static "deps/images/call.png" %}" alt="Иконка" alt="Иконка">
                    <div>
                      <strong>Контактные данные:</strong><br>
                      {% if route.organizer_phone %}
                          {{ route.organizer_phone }}<br>
                      {% endif %}
                      {% if route.organizer_email %}
                          {{ route.organizer_email }}
                      {% endif %}
                    </div>
                  </div>
                  <div class="row">
                    <div>
                        <strong>Проверяемые навыки:</strong><br>
                        {% for skill in route.skills.all %}
                            • {{ skill.description }}<br>
                        {% empty %}
                            Навыки не указаны
                        {% endfor %}
                        <br>Снаряжение предоставляется.
                    </div>
                </div>
              </div>
      
              <!-- Правая часть -->
              <div class="map-container">
                  <div class="map">
                    <img src="{% if route.image %}{{ route.image.url }}{% else %}{% static "deps/images/default-route.jpg" %}{% endif %}" 
                    alt="{{ route.name }}" 
                    class='image-border'>
                  </div>
                  <div class="buttons">
                      <a href="#" class='orange-button'>
                        <button class='orange-button'>Записаться</button>
                      </a>
                      <a href="{{route.map_link}}" class='blue-button-adress blue-button'>
                        <button class='blue-button'>Картографический материал</button>
                      </a>
                      <button 
                      class="comments-btn" 
                      data-route-id="{{ route.id }}"
                      onclick="openModal({{ route.id }})"
                  >
                      Комментарии ({{ route.comments.count }})
                  </button>
                  </div>
              </div>
              <!-- Модальное окно -->
              <div id="commentsModal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <div id="modal-body">
                        <!-- Здесь будет загружаться контент -->
                    </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
          </ul>
      
    </main>
    <footer class="main-footer">
      <div class="footer-container">
        <div class="footer-column">
            <p class="logo">
              <img src="{% static "deps/images/Group 32.png" %}" width="415" height="75" alt="Логотип">
            </p>
        </div>
        <ul class="site-navigation">
            <li class="site-navigation-item">
              <a href="#">Начало</a>
            </li>
            <li class="site-navigation-item">
              <a href="#">Список снаряжения</a>
            </li>
            <li class="site-navigation-item">
              <a href="#">Техника безопасности</a>
            </li>
            <li class="site-navigation-item">
              <a href="#">Маршруты</a>
            </li>
        </ul>
      </div>
    </footer>
  <script src="{% static "deps/js/script.js" %}">

  </script>
  </body>
</html>


<script>
  let currentRouteId = null;
  
  function openModal(routeId) {
      currentRouteId = routeId;
      const modal = document.getElementById('commentsModal');
      modal.style.display = "block";
      
      // Загрузка комментариев
      fetch(`/get-comments/${routeId}/`)
          .then(response => response.text())
          .then(html => {
              document.getElementById('modal-body').innerHTML = html;
          });
  }
  
  function closeModal() {
      document.getElementById('commentsModal').style.display = "none";
  }
  
  // Закрытие при клике вне окна
  window.onclick = function(event) {
      if (event.target == document.getElementById('commentsModal')) {
          closeModal();
      }
  }
  
  // Отправка формы
  function submitComment(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    
    // Получаем CSRF-токен из формы
    const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
    
    fetch(`/submit-comment/${currentRouteId}/`, {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': csrfToken,
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => {
        if (!response.ok) throw new Error('Ошибка сети');
        return response.json();
    })
    .then(data => {
        if (data.success) {
            form.reset();
            const commentsList = form.closest('.comments-section').querySelector('.comments-list');
            commentsList.innerHTML = data.html;
            
            // Обновляем счетчик комментариев на кнопке
            const commentBtn = document.querySelector(`[data-route-id="${currentRouteId}"]`);
            if (commentBtn) {
                commentBtn.textContent = `Комментарии (${data.count})`;
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Ошибка при отправке комментария');
    });
  }
  </script>